- op: add
  path: "/spec/template/spec/volumes/-"
  value:
    name: custom-tools
    emptyDir: {}
- op: add
  path: "/spec/template/spec/volumes/-"
  value:
    name: helm-data-home
    emptyDir: {}

- op: add
  path: "/spec/template/spec/initContainers"
  value:
    - name: get-helmfile
      image: alpine:3.8
      command: [sh, -c]
      args:
        - |
          # helmfile
          wget -qO /custom-tools/argo-cd-helmfile.sh https://raw.githubusercontent.com/travisghansen/argo-cd-helmfile/master/src/argo-cd-helmfile.sh
          chmod +x /custom-tools/argo-cd-helmfile.sh
          wget -qO /custom-tools/helmfile https://github.com/roboll/helmfile/releases/download/v0.144.0/helmfile_linux_amd64
          chmod +x /custom-tools/helmfile
      volumeMounts:
        - mountPath: /custom-tools
          name: custom-tools
        - mountPath: /helm/data
          name: helm-data-home
- op: add
  path: "/spec/template/spec/containers/0/volumeMounts/-"
  value:
    mountPath: /usr/local/bin/argo-cd-helmfile.sh
    name: custom-tools
    subPath: argo-cd-helmfile.sh
- op: add
  path: "/spec/template/spec/containers/0/volumeMounts/-"
  value:
    mountPath: /usr/local/bin/helmfile
    name: custom-tools
    subPath: helmfile
